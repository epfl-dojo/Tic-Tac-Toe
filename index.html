<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Tic Tac Toe</title>
  <link rel="stylesheet" type="text/css" href="styles/style.css" />
</head>
<body>
  <h1>Tic Tac Toe</h1>
  <table>
    <tr>
      <td class="click x1 y3"></td>
      <td class="click x2 y3"></td>
      <td class="click x3 y3"></td>
    </tr>
    <tr>
      <td class="click x1 y2"></td>
      <td class="click x2 y2"></td>
      <td class="click x3 y2"></td>
    </tr>
    <tr>
      <td class="click x1 y1"></td>
      <td class="click x2 y1"></td>
      <td class="click x3 y1"></td>
    </tr>
  </table>

  <script
  src="https://code.jquery.com/jquery-3.2.1.js"
  integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE="
  crossorigin="anonymous">
  </script>
  <script type="text/javascript">



    $(document).ready(()=>{
      var joueur1 = askName("joueur1")
      var joueur2 = askName("joueur2")
      var tour = 1;
      $('.click').on('click', function(){
        if ($(this).html() == '') {
          if(tour % 2 == 0){
            $(this).text('o');
          } else {
            $(this).text('x');
          }
          checkWin(tour, joueur1, joueur2);
          tour += 1;

        }
      })
    });

    function askName (name) {
      var joueur = 0
      while (joueur == 0) {
        var promptedName = prompt("Veuillez entrer le prénom du " + name)
        if (promptedName != "") {
          if (promptedName.match(/^\d\w*/) == null) {
            return promptedName

          }
        }
      }
    }
    function checkWin (nombredetours, joueurX, joueurO) {
      estqueqqnagane = false
      rows = []
      columns = []
      tabVal = ["a","b","c","d","e","f","g","h","i"]
      idx = 0

      $('table tr td').each(function()
      {
        if($(this).html() != ""){
          tabVal[idx] = $(this).html()
        }
        idx = idx + 1
        console.log(tabVal)
      });

      //Test de la première ligne
      if(tabVal[0] == tabVal[1] && tabVal[0] == tabVal[2]){
        //console.log("Au tour " + nombredetours + ", " + tabVal[0] + " a gagné")
        estqueqqnagane = tabVal[0]
      }

      //Test de la deuxième ligne
      if(tabVal[3] == tabVal[4] && tabVal[3] == tabVal[5]){
        //console.log("Au tour " + nombredetours + ", " + tabVal[3] + " a gagné")
        estqueqqnagane = tabVal[3]
      }

      //Test de la troisième ligne
      if(tabVal[6] == tabVal[7] && tabVal[6] == tabVal[8]){
        //console.log("Au tour " + nombredetours + ", " + tabVal[6] + " a gagné")
        estqueqqnagane = tabVal[6]
      }

      //Test de la première colonne
      if(tabVal[0] == tabVal[3] && tabVal[0] == tabVal[6]){
        //console.log("Au tour " + nombredetours + ", " + tabVal[0] + " a gagné")
        estqueqqnagane = tabVal[0]
      }

      //Test de la deuxième colonne
      if(tabVal[1] == tabVal[4] && tabVal[1] == tabVal[7]){
        //console.log("Au tour " + nombredetours + ", " + tabVal[1] + " a gagné")
        estqueqqnagane = tabVal[1]
      }

      //Test de la troisième colonne
      if(tabVal[2] == tabVal[5] && tabVal[2] == tabVal[8]){
        //console.log("Au tour " + nombredetours + ", " + tabVal[2] + " a gagné")
        estqueqqnagane = tabVal[2]
      }

      //Test de la première diagonale
      if(tabVal[0] == tabVal[4] && tabVal[0] == tabVal[8]){
        //console.log("Au tour " + nombredetours + ", " + tabVal[0] + " a gagné")
        estqueqqnagane = tabVal[0]
      }

      //Test de la deuxième diagonale
      if(tabVal[2] == tabVal[4] && tabVal[2] == tabVal[6]){
        //console.log("Au tour " + nombredetours + ", " + tabVal[2] + " a gagné")
        estqueqqnagane = tabVal[2]
      }
      if(estqueqqnagane){
        if(estqueqqnagane == "x"){
          estqueqqnagane = joueurX;
        } else {
          estqueqqnagane = joueurO;
        }
        alert("Quelqu'un a gagné! c'est " + estqueqqnagane)
        rejouer ()
      }
      else{
        // alert("Egalité personne n'a gagné")
      }

      if (nombredetours == 9 && !estqueqqnagane) {
        alert("Egalité personne n'a gagné")
        rejouer()
      }
    // TODO - que faire si personne n'a gagné -> EGALITE
    // TODO - A la fin de la partie, demander si on veut recommencer une partie
    // TODO - Faire une IA pour jouer tout seul
    }
    function rejouer(){
      if (confirm("Voulez-vous rejouer ?")) {
        location.reload();
      } else {
        window.location = "https://9gag.com";
      }
    }
  </script>
</body>
</html>
